<!DOCTYPE html>
<html>
<head>
    <title>Rover Dashboard</title>
    <style>
        body { background: #1a1a1a; color: white; font-family: sans-serif; text-align: center; margin: 0; }
        .container { display: flex; flex-direction: column; align-items: center; padding: 20px; }
        
        /* The container for our WebRTC feed */
        .video-container { 
            width: 80%; 
            max-width: 800px; 
            aspect-ratio: 16 / 9;
            border: 2px solid #444; 
            border-radius: 8px; 
            overflow: hidden; 
            background: black; 
        }
        iframe { width: 100%; height: 100%; border: none; }

        .controls { margin-top: 20px; display: grid; grid-template-columns: repeat(3, 80px); gap: 15px; }
        button { 
            padding: 20px; font-size: 20px; font-weight: bold; cursor: pointer; 
            background: #333; color: white; border: 1px solid #555; border-radius: 8px; 
            transition: transform 0.1s, background 0.2s;
        }
        button:active { transform: scale(0.95); background: #f39c12; }
        #status { margin-top: 10px; font-size: 14px; color: #2ecc71; font-family: monospace; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ROVER v1 - WEBRTC LOW LATENCY</h1>
        
        <div class="video-container">
            <iframe id="streamFrame" src="http://rover.tail9d0237.ts.net:8889/cam"></iframe>
        </div>

        <div id="status">‚óè WEBRTC CONNECTED</div>

        <div class="controls">
            <div></div><button onmousedown="sendCommand('up')" onmouseup="stop()">W</button><div></div>
            <button onmousedown="sendCommand('left')" onmouseup="stop()">A</button>
            <button onmousedown="sendCommand('down')" onmouseup="stop()">S</button>
            <button onmousedown="sendCommand('right')" onmouseup="stop()">D</button>
        </div>
    </div>

    <script>
        // Replace with your actual Pi Tailscale IP
        const PI_IP = "rover.tail9d0237.ts.net"; 

        function sendCommand(dir) {
            console.log("Moving:", dir);
            // Replace localhost with PI_IP so it works from your phone too!
            fetch(`http://${PI_IP}:3000/api/control/${dir}`, { method: 'POST' })
                .catch(err => console.error("Control Error:", err));
        }

        function stop() {
            fetch(`http://${PI_IP}:3000/api/control/stop`, { method: 'POST' });
        }

        // Optional: Keyboard support
        window.addEventListener('keydown', (e) => {
            const keys = { 'w': 'up', 'a': 'left', 's': 'down', 'd': 'right' };
            if (keys[e.key.toLowerCase()]) sendCommand(keys[e.key.toLowerCase()]);
        });
        window.addEventListener('keyup', () => stop());
    </script>
</body>
</html>